<!doctypehtml><html lang=en><meta charset=utf8><meta content="width=device-width,initial-scale=1"name=viewport><link href=/syntax.css rel=stylesheet><link href=/index.css rel=stylesheet><link href=/big.css rel=stylesheet media=(min-width:32em)><title>Hello, EPUB! | wooorm.com</title><link href=https://wooorm.com/blog/hello-epub/ rel=canonical><meta content="brief intro to the format"name=description><meta content=epub,ebook,oss,open,source,ties,music,shows name=keywords><meta content="Titus Wormer"name=author><meta content="¬© 2020 Titus Wormer"name=copyright><meta content=#000 name=theme-color><meta content=article property=og:type><meta content=wooorm.com property=og:site_name><meta content=https://wooorm.com/blog/hello-epub/ property=og:url><meta content="Hello, EPUB!"property=og:title><meta content="brief intro to the format"property=og:description><meta content=2020-05-27T00:00:00.000Z property=article:published_time><meta content=2020-05-27T00:00:00.000Z property=article:modified_time><meta content=epub property=article:tag><meta content=ebook property=article:tag><meta content=@wooorm name=twitter:site><meta content=@wooorm name=twitter:creator><link href=data:image/x-icon;, rel="icon shortcut"type=image/x-icon><header><nav class=top><ol><li class=home><span class=text><a href=/>@wooorm</a></span><li class=thanks><span class=text><a href=/thanks/>Thanks</a></span><li class=blog><span class=text><a href=/blog/ class=active>Writing</a></span><li class=photos><span class=text><a href=/photos/>Photos</a></span><li class=watching><span class=text><a href=/watching/>Watching</a></span><li class=listening><span class=text><a href=/listening/>Listening</a></span></ol></nav></header><main><div class="article content"><div class=article-inner><h1 id=hello-epub-->Hello, EPUB! üëã</h1><p>EPUB (<em>Electronic Publication</em>) is a format for ebooks. It‚Äôs the most widely used open format for digital books. EPUB files can be read on most all devices. Sometimes not automatically, but then there are <a href=https://calibre-ebook.com>converters</a> that transform them to create different formats that are usable for your device.<p>A different format exists, which is unfortunately more popular: the Kindle format, used by Amazon. In fact, there are many Kindle formats: AZW (KF7); AZW1; AZW3 (KF8), AZW4, AZK (<a href=https://wiki.mobileread.com/wiki/AZK>summed up</a> as ‚ÄúAZK is another binary format created by Amazon for reasons that are currently not clear‚Äù), AZW8, and many more. Kindle is a proprietary mess, and I‚Äôm not interested in ranting or writing about it.<p>There are many ways to create EPUB files, such as Word, Pages, or InDesign, but this article shows that it‚Äôs code, which can be read and written by hand too!<h2 id=whats-in-an-epub>What‚Äôs in an EPUB?</h2><p>EPUB can be thought of the web platform (HTML, CSS, images, sometimes JS), glued together with XML, archived together with an <code>.epub</code> extension instead of <code>.zip</code>. Very much like a static site with a service worker to bring it offline, but then instead of JavaScript, it‚Äôs bundled with XML into a single archive.<p>A good way to learn more about the web is View Source. You can do that to with EPUBs: rename the file from <code>book.epub</code> to <code>book.zip</code> and unzip that with your favorite tool (or do <code>unzip path/to/book.epub -d path/to/directory</code> on unix/macos), then open the result in your text editor of choice to see it‚Äôs made.<p>To create an EPUB, a couple things are needed. What we‚Äôre going to create here is a directory with the following files:<pre><code class="hljs language-txt">book/
  META-INF/
    container.xml
  content.opf
  index.xhtml
  mimetype
</code></pre><h2 id=mimetype><code>mimetype</code></h2><p>First, a file called <code>mimetype</code>, without extension, must exist in the root of the folder, with following value exactly copied over:<pre><code class="hljs language-txt">application/epub+zip
</code></pre><p><em>Note: there must not be a newline at the end of that file</em>.<p>The existence and contents of the file signals that a ZIP archive, which could be huge and slow to unzip, represents an epub ebook.<p>There isn‚Äôt much else to the file. But if you‚Äôre interested, it‚Äôs specified in <a href=https://www.w3.org/publishing/epub3/epub-ocf.html#sec-zip-container-mime>EPUB OCF 3.2 ¬ß 4.3</a>.<h2 id=meta-infcontainerxml><code>META-INF/container.xml</code></h2><p>The second requirement is that a <code>container.xml</code> file exists, in a <code>META-INF/</code> directory.<p>The contents of <code>container.xml</code> looks like this:<pre><code class="hljs language-xml"><span class=hljs-meta>&#60?xml version="1.0"?></span>
<span class=hljs-tag>&lt;<span class=hljs-name>container</span> <span class=hljs-attr>version</span>=<span class=hljs-string>"1.0"</span> <span class=hljs-attr>xmlns</span>=<span class=hljs-string>"urn:oasis:names:tc:opendocument:xmlns:container"</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>rootfiles</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>rootfile</span> <span class=hljs-attr>full-path</span>=<span class=hljs-string>"content.opf"</span> <span class=hljs-attr>media-type</span>=<span class=hljs-string>"application/oebps-package+xml"</span>/></span>
  <span class=hljs-tag>&#60/<span class=hljs-name>rootfiles</span>></span>
<span class=hljs-tag>&#60/<span class=hljs-name>container</span>></span>
</code></pre><p>There is a tiny bit more to this file if you‚Äôre going to do weird things, but in 99.9% of cases this is exactly what you need. If you‚Äôre interested, it‚Äôs specified in <a href=https://www.w3.org/publishing/epub3/epub-ocf.html#sec-container-metainf-container.xml>EPUB OCF 3.2 ¬ß 3.5.2.1</a>. The role of this file is to point to the next XML file, through the path defined with the <code>full-path</code> attribute on the <code>rootfile</code> element.<p>It could point to a different place (often: <code>OEBPS/content.opf</code>). You‚Äôre free to structure your books as you please, but for this example I‚Äôm keeping the file structure as flat as possible.<h2 id=contentopf><code>content.opf</code></h2><p>The last XML file that is needed is <code>content.opf</code>. It can be placed anywhere in the book, but must be referenced correctly by the <code>container.xml</code> file.<p>The bare minimum, with some extra metadata, looks like so:<pre><code class="hljs language-xml"><span class=hljs-meta>&#60?xml version="1.0"?></span>
<span class=hljs-tag>&lt;<span class=hljs-name>package</span> <span class=hljs-attr>version</span>=<span class=hljs-string>"3.0"</span> <span class=hljs-attr>xmlns</span>=<span class=hljs-string>"http://www.idpf.org/2007/opf"</span> <span class=hljs-attr>unique-identifier</span>=<span class=hljs-string>"bookid"</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>metadata</span> <span class=hljs-attr>xmlns:dc</span>=<span class=hljs-string>"http://purl.org/dc/elements/1.1/"</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>dc:title</span>></span>Book Title<span class=hljs-tag>&#60/<span class=hljs-name>dc:title</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>dc:creator</span>></span>Author Name<span class=hljs-tag>&#60/<span class=hljs-name>dc:creator</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>dc:date</span>></span>2020-02-27T00:00:00Z<span class=hljs-tag>&#60/<span class=hljs-name>dc:date</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>dc:rights</span>></span>Copyright ¬© 2020 Author Name<span class=hljs-tag>&#60/<span class=hljs-name>dc:rights</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>dc:language</span>></span>en<span class=hljs-tag>&#60/<span class=hljs-name>dc:language</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>meta</span> <span class=hljs-attr>property</span>=<span class=hljs-string>"dcterms:modified"</span>></span>2020-02-27T00:00:00Z<span class=hljs-tag>&#60/<span class=hljs-name>meta</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>dc:identifier</span> <span class=hljs-attr>id</span>=<span class=hljs-string>"bookid"</span>></span>tag:example.com,2020:book-title:1<span class=hljs-tag>&#60/<span class=hljs-name>dc:identifier</span>></span>
  <span class=hljs-tag>&#60/<span class=hljs-name>metadata</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>manifest</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>item</span> <span class=hljs-attr>id</span>=<span class=hljs-string>"index"</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"index.xhtml"</span> <span class=hljs-attr>media-type</span>=<span class=hljs-string>"application/xhtml+xml"</span> <span class=hljs-attr>properties</span>=<span class=hljs-string>"nav"</span>/></span>
  <span class=hljs-tag>&#60/<span class=hljs-name>manifest</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>spine</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>itemref</span> <span class=hljs-attr>idref</span>=<span class=hljs-string>"index"</span>/></span>
  <span class=hljs-tag>&#60/<span class=hljs-name>spine</span>></span>
<span class=hljs-tag>&#60/<span class=hljs-name>package</span>></span>
</code></pre><p>The file consists of a single <code>&#60package></code> element, which includes three sections each in separate container elements:<ul><li><code>&#60metadata></code>, which is sort of like the <code>&#60head></code> in HTML (or <a href=https://developer.mozilla.org/docs/Web/Manifest><code>.webmanifest</code></a>)<li><code>&#60manifest></code>, which lists all the files that make up the book with their media types<li><code>&#60spine></code>, which defines the items in <code>&#60manifest></code> that make up the content of the book, and in what order they are to be placed</ul><p>The last part, <code>&#60spine></code>, is important to clarify: as books are typically long form, and rendering hundreds of pages at once takes a while, ebooks are split up in separate files, and concatenated together by EPUB readers.<p>For this small example, a single content file is fine, but typically books are split up per chapter, or maybe even per section.<p>The <code>properties</code> attribute on <code>&#60item></code> elements adds some extra data to that entry. In this case, it defines that the file it‚Äôs on contains the table of contents. Something like <code>properties="scripted mathml"</code> would define that the file includes JavaScript and MathML.<p>Another interesting part is that the <code>&#60package></code> element has a <code>unique-identifier</code> attribute, which points to another element by its <code>id</code> attribute (which should be a <code>&#60dc:identifier></code>). Any URI can be placed in that element. It could be an ISBN (such as <code>isbn:978-1-234567-89-1</code>), but there is no reason to get one for ebooks (and it often costs money). You can also use a UUID (such as <code>urn:uuid:B9B412F2-CAAD-4A44-B91F-A375068478A0</code>). I like using the <a href=https://en.wikipedia.org/wiki/Tag_URI_scheme>tag URI scheme</a>.<p>The value of <code>&#60dc:identifier></code> is a bit like the semver major: it shouldn‚Äôt change for minor changes.<p>More info on the <code>content.opf</code> file is available in <a href=https://www.w3.org/publishing/epub3/epub-packages.html#sec-package-def>EPUB Packages 3.2 ¬ß 3.4</a>.<h2 id=content>Content</h2><p>Last, we need content! We‚Äôve set up the needed ancillary files to make that happen. We can now add a file, let‚Äôs call it <code>index.xhtml</code>, and add the following to it:<pre><code class="hljs language-html"><span class=hljs-meta>&#60!DOCTYPE <span class=hljs-meta-keyword>html</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>html</span> <span class=hljs-attr>xmlns</span>=<span class=hljs-string>"http://www.w3.org/1999/xhtml"</span> <span class=hljs-attr>xmlns:epub</span>=<span class=hljs-string>"http://www.idpf.org/2007/ops"</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>head</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>meta</span> <span class=hljs-attr>charset</span>=<span class=hljs-string>"utf-8"</span>/></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>title</span>></span><span class=hljs-tag>&#60/<span class=hljs-name>title</span>></span>
  <span class=hljs-tag>&#60/<span class=hljs-name>head</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>body</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>h1</span> <span class=hljs-attr>id</span>=<span class=hljs-string>"hello-world"</span>></span>Hello, World!<span class=hljs-tag>&#60/<span class=hljs-name>h1</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>nav</span> <span class=hljs-attr>epub:type</span>=<span class=hljs-string>"toc"</span>></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>h2</span>></span>Contents<span class=hljs-tag>&#60/<span class=hljs-name>h2</span>></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>ol</span>></span>
        <span class=hljs-tag>&lt;<span class=hljs-name>li</span>></span><span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"#hello-world"</span>></span>Hello, World!<span class=hljs-tag>&#60/<span class=hljs-name>a</span>></span><span class=hljs-tag>&#60/<span class=hljs-name>li</span>></span>
      <span class=hljs-tag>&#60/<span class=hljs-name>ol</span>></span>
    <span class=hljs-tag>&#60/<span class=hljs-name>nav</span>></span>
  <span class=hljs-tag>&#60/<span class=hljs-name>body</span>></span>
<span class=hljs-tag>&#60/<span class=hljs-name>html</span>></span>
</code></pre><p>Important to note here that the syntax is in XHTML. Not HTML. They are slightly different syntaxes. With HTML, the browser does more work to assume you had the best intentions. With XHTML, you will be yelled at if you don‚Äôt put a slash on <code>&#60img/></code>, amongst other reasons.<p>Otherwise, this looks very similar to the HTML needed for a website: a <code>&#60head></code>, a <code>&#60body></code>, the same semantic elements.<p>What may stand out though, is that it‚Äôs pretty big for a Hello World! That‚Äôs mostly because of the table of content. Almost all apps or ereaders support a quick way to get to that landmark, and it‚Äôs something readers expect. So it‚Äôs a required feature in EPUB files.<p>The <code>&#60head></code> doesn‚Äôt matter as much in EPUB as when building a website, you still use it to link to CSS, but the metadata that typically is in <code>&#60head></code> is now pulled out into <code>content.opf</code>.<p>A namespace is defined on the HTML element with <code>xmlns:epub</code>, linking the prefix <code>epub</code> to the namespace <code>http://www.idpf.org/2007/ops</code>, and later defining <code>epub:type="toc"</code> on the <code>&#60nav></code> element. There are other extra things you can do with the <code>epub:type</code> attribute, such as footnotes, but that‚Äôs for another time.<h2 id=final-steps>Final steps</h2><p>Finally, what needs to be done is to combine those files into a ZIP archive. Unfortunately, using your favorite ZIP archive tool won‚Äôt work, as there are some peculiar things needed for EPUBs. From the directory where you have your book files, do the following in a terminal:<pre><code class="hljs language-sh">zip -0X book.epub mimetype; zip -0DXr book.epub . -x **/.* *.epub
</code></pre><blockquote><p>Note: this works on macOS, and I unfortunately don‚Äôt have experience with how to do it on other operating systems. Do let me know if you do!</blockquote><p>What this does is create a file called <code>book.epub</code> in your book directory, where <code>mimetype</code> is the first entry, and adding everything else (except for hidden files or EPUBs), and <em>not</em> compressing the archive.<p>If you prefer GUIs over bash one liners, which is very understandable, <a href=https://ebookflightdeck.com/handbook/zipping>some of them are listed here</a>.<p>This gives us an EPUB file, <code>book.epub</code>:<pre><code class="hljs language-diff"> book/
   META-INF/
     container.xml
<span class=hljs-addition>+  book.epub</span>
   content.opf
   index.xhtml
   mimetype
</code></pre><p>Which you can load up in for example Books.app. Or Adobe Digital Editions. Or some other ereader app that you prefer!<h2 id=closing-thoughts>Closing thoughts</h2><p>I hope this walk through how to create a Hello, World! for EPUB shows that, while a bit much and weird, it is doable to create EPUB files yourself, by hand!<p>There‚Äôs a lot more to them though. I think I‚Äôll write more about EPUBs in the future. When I do, I‚Äôll link that up here!</div></div></main><footer></footer>